<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Profile | Barangay Market Area</title>
  <link rel="stylesheet" href="profile.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="icon" type="image/png" href="logo.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

</head>

<body>
  <!-- HEADER SECTION -->
		<header class="header_gradient">
  			<div class="header-left">
    			<img class="market-area-logo" src="logo.png" alt="Logo" />
    			<div class="barangay-title">
      			<p class="barangay-market-area">Barangay Market Area:<br>E-Blotter System</p>
    			</div>
  			</div>

  			<div class="navbar">
  				<div class="nav-links">
    				<a href="residentHomepage.html">Home</a>
    				<a href="my_complaints.html">My Complaints</a>
    				<a href="contact.html">Contacts</a>
  				</div>

  			<!-- Profile + Sidebar Wrapper -->
			<div class="profile-sidebar-wrapper">
  			<!-- Profile Trigger -->
  			<div class="profile-link" id="profileTrigger">
    			<div class="profile"></div>
  			</div>

  			<!-- Collapsible Sidebar -->
  			<div class="sidebar collapsed" id="profileSidebar">
  				<a href="accounts_security.html" class="sidebar-item" data-tooltip="Adjust your settings">
    				<i class="icon">‚öôÔ∏è</i>
    				<span class="label">Settings</span>
  				</a>
  				<a href="residentLogin.html" class="sidebar-item" id="logout-btn" onclick="return showLogoutConfirmation()" data-tooltip="Log out from your account">
          <i class="icon">üö™</i>
          <span class="label">Logout</span>
          </a>
			</div>
			</div>
		</div>
	</div>
</header>
 
 <section class="page-container">
    <div class="profile-container">
      <div class="sidebar_body">

        <a href="accounts_security.html" id="backButton" class="icon-button" title="Back to Homepage">
        <div class="back-circle">‚Üê</div>
      </a>
      

        <div class="profile-pic">
          <div class="circle-img">JD</div>
          <div class="camera-wrapper disabled fade-out">
            <div class="camera-icon">üì∑</div>
            <input type="file" id="profileUpload" accept="image/*" style="display: none;">
          </div>

        </div>
        <div class="sidebar-links">
          <span>üë§</span> Personal Information
        </div>
      </div>

      <div class="profile-form">
        <h2>Personal Information</h2>
        
        <div class="info-grid">
          <div class="info-row">
            <div class="info-field" data-field="firstName">
              <div class="info-label">First Name</div>
              <div class="info-value" contenteditable="false" id="firstName">Juan</div>
            </div>
            <div class="info-field" data-field="lastName">
              <div class="info-label">Last Name</div>
              <div class="info-value" contenteditable="false" id="lastName">Dela Cruz</div>
            </div>
          </div>
          
          <div class="info-field email">
            <div class="info-label">Email Address</div>
            <div class="info-value">juandelacruz@gmail.com</div>
          </div>
          
          <div class="info-field address" data-field="address">
            <div class="info-label">Address</div>
            <div class="info-value" contenteditable="false" id="address">Brgy. Market Area, Lipa City, Batangas</div>
          </div>
        </div>

        <div class="action-buttons">
          <a href="change_email.html" class="btn btn-secondary" id="changeEmailBtn">
            ‚úâÔ∏è Change Email
          </a>

          <button id="editProfileBtn" class="btn btn-primary">‚úèÔ∏è Edit Profile</button>

          <div class="action-buttons edit-mode-buttons" style="display: none;">
            <button id="saveProfileBtn" class="btn btn-success">üíæ Save</button>
            <button id="cancelEditBtn" class="btn btn-secondary">‚ùå Cancel</button>
          </div>

        </div>
      </div>
    </div>
  </section>

  <!--FOOTER SECTION-->
		<footer class="footer">
            <div class="footer-left">
                <img class="market-area-logo2" src="logo.png" alt="Barangay Logo" />
                <p class="a-barangay-that">
                    A Barangay that is God-centered, united, service-oriented, inclusive, and responsive ‚Äî guided by faith, integrity, and accountable governance.
                </p>
            </div>

            <div class="footer-right-group">
                <div class="footer-middle">
              <h4 class="footer-heading">Quick Links</h4>
      				<p class="footer-link"><a href="my_complaints.html" id="footer-link">My Complaints</a></p>
              <p class="footer-link"><a href="contact.html" id="footer-link">Contacts</a></p>
              <p class="footer-link"><a href="settings.html" id="footer-link">Settings</a></p>
                </div>

            <div class="footer-right">
                <h4 class="footer-heading">Site Info</h4>
                <p class="footer-link"><a href="privpolicy.html" id="footer-terms-link">Privacy Policy</a></p>
                <p class="footer-link"><a href="term&con.html" id="footer-terms-link">Terms & Conditions</a></p>
            </div>
            </div>
            </footer>

            <div id="logoutModal" class="custom-modal">
  <div class="modal-content">
    <p><strong>Are you sure you want to logout?</strong></p>
    <div class="modal-buttons">
      <button class="confirm-btn" onclick="confirmLogoutAction()">Yes, Logout</button>
      <button class="cancel-btn" onclick="closeLogoutModal()">Cancel</button>
    </div>
  </div>
</div>

<!-- Enhanced Logout Modal -->
    <div id="logoutConfirmModal" class="out-custom-modal">
        <div class="out-modal-content">
            <button class="close-out-btn" onclick="hideLogoutModal()" aria-label="Close">&times;</button>
            
            <div class="out-modal-icon">
                <span>üö™</span>
            </div>
            
            <h2 class="out-modal-title">Confirm Logout</h2>
            <p class="out-modal-message">
                Are you sure you want to logout? You will need to sign in again to access your account.
            </p>
            
            <div class="out-modal-buttons">
                <button class="out-btn out-btn-cancel" onclick="hideLogoutModal()">
                    Cancel
                </button>
                <button class="out-btn out-btn-confirm" onclick="proceedWithLogout()">
                    Yes, Logout
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Profile Confirmation Modal -->
<div id="confirmEditModal" class="out-custom-modal">
  <div class="out-modal-content">
    <button class="close-out-btn" onclick="hideEditModal()" aria-label="Close">&times;</button>

    <div class="out-modal-icon" style="background: linear-gradient(135deg, #D0B564, #ad9448);">
      <span>‚úîÔ∏è</span>
    </div>

    <h2 class="out-modal-title">Confirm Profile Update</h2>
    <p class="out-modal-message">
      Are you sure you want to save your profile changes?
    </p>

    <div class="out-modal-buttons">
      <button class="out-btn out-btn-cancel" onclick="hideEditModal()">Cancel</button>
      <button class="out-btn out-btn-confirm" style="background: linear-gradient(135deg, #8A9A5B, #6A7337);" onclick="confirmProfileUpdate()">
        Yes, Save
      </button>
    </div>
  </div>
</div>


<!-- Profile Saved Toast Notification -->
<div id="profileSavedToast" class="toast-notification">
  <div class="toast-icon" style="background: linear-gradient(135deg, #8A9A5B, #6A7337);">‚úîÔ∏è</div>
  <div class="toast-message">Profile changes saved successfully!</div>
</div>

<script>
    //settings
  const profileTrigger = document.getElementById('profileTrigger');
  const sidebar = document.getElementById('profileSidebar');

  profileTrigger.addEventListener('click', (e) => {
    e.preventDefault(); // prevent anchor from navigating
    sidebar.classList.toggle('show');
  });

  document.addEventListener('click', function (e) {
    const wrapper = document.querySelector('.profile-sidebar-wrapper');
    if (!wrapper.contains(e.target)) {
      sidebar.classList.remove('show');
    }
  });

  function confirmLogout() {
  document.getElementById('logoutModal').style.display = 'flex';
  return false; // Prevent the <a> tag from redirecting
}

function closeLogoutModal() {
  document.getElementById('logoutModal').style.display = 'none';
}

function confirmLogoutAction() {
  window.location.href = "residentLogin.html"; // ‚úÖ your original destination
};

// ==== ENHANCED LOGOUT CONFIRMATION ====
        
        function showLogoutConfirmation() {
            const logoutModal = document.getElementById('logoutConfirmModal');
            logoutModal.style.display = 'flex';
            
            // Add show class after a brief delay for smooth animation
            setTimeout(() => {
                logoutModal.classList.add('show');
            }, 10);
            
            // Prevent body scroll when modal is open
            document.body.style.overflow = 'hidden';
            
            // Focus trap for accessibility
            trapFocus(logoutModal);
            
            return false; // Prevent the <a> tag from redirecting
        }

        function hideLogoutModal() {
            const logoutModal = document.getElementById('logoutConfirmModal');
            logoutModal.classList.remove('show');
            
            // Hide modal after animation completes
            setTimeout(() => {
                logoutModal.style.display = 'none';
                document.body.style.overflow = ''; // Restore body scroll
            }, 300);
        }

        function proceedWithLogout() {
            // Show loading state
            const confirmBtn = document.querySelector('.out-btn-confirm');
            const originalText = confirmBtn.textContent;
            confirmBtn.textContent = 'Logging out...';
            confirmBtn.disabled = true;
            
            // Simulate logout process (replace with your actual logout logic)
            setTimeout(() => {
                // Redirect to login page
                window.location.href = "residentLogin.html";
            }, 1000);
        }

        // Enhanced Features
        
        // Close modal when clicking outside
        document.getElementById('logoutConfirmModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideLogoutModal();
            }
        });
 
        // Close modal with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                hideLogoutModal();
            }
        });

        // Focus trap for accessibility
        function trapFocus(logoutModal) {
            const focusableElements = logoutModal.querySelectorAll(
                'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
            );
            const firstElement = focusableElements[0];
            const lastElement = focusableElements[focusableElements.length - 1];

            logoutModal.addEventListener('keydown', function(e) {
                if (e.key === 'Tab') {
                    if (e.shiftKey) {
                        if (document.activeElement === firstElement) {
                            lastElement.focus();
                            e.preventDefault();
                        }
                    } else {
                        if (document.activeElement === lastElement) {
                            firstElement.focus();
                            e.preventDefault();
                        }
                    }
                }
            });

            // Focus first element
            firstElement.focus();
        }

        // Optional: Auto-close after inactivity
        let logoutInactivityTimer;
        
        function resetLogoutInactivityTimer() {
            clearTimeout(logoutInactivityTimer);
            logoutInactivityTimer = setTimeout(() => {
                if (document.getElementById('logoutConfirmModal').style.display === 'flex') {
                    hideLogoutModal();
                }
            }, 30000); // Auto-close after 30 seconds of inactivity
        }

        // Reset timer on user interaction
        ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'].forEach(event => {
            document.addEventListener(event, resetLogoutInactivityTimer, true);
        });
// ======================
// PROFILE EDIT FUNCTIONALITY
// ======================

const editBtn = document.getElementById('editProfileBtn');
const saveBtn = document.getElementById('saveProfileBtn');
const cancelBtn = document.getElementById('cancelEditBtn');
const editButtons = document.querySelector('.edit-mode-buttons');

const firstName = document.getElementById('firstName');
const lastName = document.getElementById('lastName');
const address = document.getElementById('address');
const cameraWrapper = document.querySelector('.camera-wrapper');
const changeEmailBtn = document.getElementById('changeEmailBtn');

// Store original profile data
let originalProfile = {};

editBtn.addEventListener('click', () => {
  [firstName, lastName, address].forEach(field => {
    originalProfile[field.id] = field.textContent.trim();
    field.contentEditable = true;
    field.style.borderBottom = '1px dashed #aaa';
  });

  // Enable camera
  cameraWrapper.classList.remove('disabled');
  cameraWrapper.classList.remove('fade-out');

  // Hide "Change Email" and Edit button, show Save/Cancel
  changeEmailBtn.style.display = 'none';
  editBtn.style.display = 'none';
  editButtons.style.display = 'flex';
});

cancelBtn.addEventListener('click', () => {
  [firstName, lastName, address].forEach(field => {
    field.textContent = originalProfile[field.id];
  });
  disableEditMode();
});

saveBtn.addEventListener('click', () => {
  showEditModal();
});

function showEditModal() {
  const modal = document.getElementById('confirmEditModal');
  modal.style.display = 'flex';
  setTimeout(() => {
    modal.classList.add('show');
  }, 10);
  document.body.style.overflow = 'hidden';
}

function hideEditModal() {
  const modal = document.getElementById('confirmEditModal');
  modal.classList.remove('show');
  setTimeout(() => {
    modal.style.display = 'none';
    document.body.style.overflow = '';
  }, 300);
}

function confirmProfileUpdate() {
  disableEditMode();
  hideEditModal();
  showProfileSavedToast();
}


function disableEditMode() {
  [firstName, lastName, address].forEach(field => {
    field.contentEditable = false;
    field.style.borderBottom = 'none';
  });

  // Disable camera
  cameraWrapper.classList.add('disabled');
  cameraWrapper.classList.add('fade-out');

  // Restore button visibility
  changeEmailBtn.style.display = 'inline-block';
  editBtn.style.display = 'inline-block';
  editButtons.style.display = 'none';
}

document.getElementById('confirmEditModal').addEventListener('click', function (e) {
  if (e.target === this) {
    hideEditModal();
  }
});

document.addEventListener('keydown', function (e) {
  if (e.key === 'Escape') {
    hideEditModal();
  }
});

function showProfileSavedToast() {
  const toast = document.getElementById('profileSavedToast');
  toast.classList.add('show');

  setTimeout(() => {
    toast.classList.remove('show');
  }, 3000); // Visible for 3 seconds
}


// ======================
// PROFILE IMAGE UPLOAD
// ======================

const profileUpload = document.getElementById('profileUpload');
const profileCircle = document.querySelector('.circle-img');

cameraWrapper.addEventListener('click', () => {
  if (!cameraWrapper.classList.contains('disabled')) {
    profileUpload.click();
  }
});

profileUpload.addEventListener('change', function () {
  const file = this.files[0];
  if (file && file.type.startsWith('image/')) {
    const reader = new FileReader();
    reader.onload = function (e) {
      profileCircle.style.backgroundImage = `url('${e.target.result}')`;
      profileCircle.style.backgroundSize = 'cover';
      profileCircle.style.backgroundPosition = 'center';
      profileCircle.textContent = ''; // Remove initials
    };
    reader.readAsDataURL(file);
  }
});

</script>

</body>
</html>
