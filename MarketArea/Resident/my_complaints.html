<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Complaint History</title>
  <link rel="icon" type="image/png" href="logo.png">
  <link rel="stylesheet" href="my_comp.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Trebuchet+MS&display=swap" rel="stylesheet">

</head>
<body>

  <!-- HEADER SECTION -->
	<header class="header_gradient">
  		<div class="header-left">
    		<img class="market-area-logo" src="logo.png" alt="Logo" />
    		<div class="barangay-title">
      		    <p class="barangay-market-area">Barangay Market Area:<br>E-Blotter System</p>
    	    </div>
  		</div>

  		<div class="navbar">
  			<div class="nav-links">
    			<a href="residentHomepage.html">Home</a>
    			<a href="my_complaints.html" class="active">My Complaints</a>
    			<a href="contact.html">Contacts</a>
  			</div>

  	<!-- Profile + Sidebar Wrapper -->
		<div class="profile-sidebar-wrapper">
  	<!-- Profile Trigger -->
  		<div class="profile-link" id="profileTrigger">
    		<div class="profile"></div>
  		</div>

  	<!-- Collapsible Sidebar -->
  			<div class="sidebar collapsed" id="profileSidebar">
        <a href="accounts_security.html" class="sidebar-item" data-tooltip="Adjust your settings">
    				<i class="icon">‚öôÔ∏è</i>
    				<span class="label">Settings</span>
  			</a>
  				<a href="residentLogin.html" class="sidebar-item" id="logout-btn" onclick="return showLogoutConfirmation()" data-tooltip="Log out from your account">
            <i class="icon">üö™</i>
            <span class="label">Logout</span>
          </a>

			</div>
			</div>
		</div>
        </div>
	</header>

  <!-- Main Content Section -->
  <main class="content">
    <div class="content-inner">

<!-- Complaint History Table Section -->
<div class="complaints-section">

  <!-- Header -->
  <div class="complaints-header">
    <div class="complaint-icon animated-icon">
      <img src="history_icon.png" alt="Complaint Icon">
    </div>
    <div class="complaint-text">
      <h2>My Complaints</h2>
    </div>
  </div>

  <!-- Search and Filter Controls -->
  <div class="controls">
    
    <!-- Filter Dropdown Button -->
    <div class="dropdown" style="position: relative;">
      <button class="filter-button" onclick="toggleDropdown()" title="Filter content">‚è≥</button>

      <!-- Dropdown Menu -->
      <div id="dropdownMenu">
        <div class="filter-group">
          <label for="filter-date">Date</label>
          <input type="date" id="filter-date">
        </div>

        <div class="filter-group">
          <label for="filter-type">Type of Complaint</label>
          <select id="filter-type">
            <option value="">All</option>
            <option value="Noise">Noise</option>
            <option value="Littering">Littering</option>
            <option value="Sanitation">Sanitation</option>
            <option value="Others">Others</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="filter-status">Status</label>
          <select id="filter-status">
            <option value="">All</option>
            <option value="Pending">Pending</option>
            <option value="In Progress">In Progress</option>
            <option value="Resolved">Resolved</option>
          </select>
        </div>

        <!-- Filter Buttons -->
        <div class="filter-actions">
          <button onclick="applyFilters()">Apply Filters</button>
          <button onclick="clearFilters()" class="clear-btn">Clear Filters</button>
        </div>
      </div>
    </div>

    <!-- Search Bar -->
    <input type="text" placeholder="Search by keyword..." class="search-bar" id="search-input" oninput="applyFilters()">
  </div>

<table class="complaints-table" id="complaintsTable">
    <thead>
      <tr>
        <th>Date Filed</th>
        <th>Name</th>
        <th>Type of Complaint</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <!-- Add multiple rows for testing pagination -->
      <tr>
        <td>03/03/25</td>
        <td>Juan De Luna</td>
        <td>Noise</td>
        <td><span class="status">Resolved</span></td>
        <td><button class="details-btn">View</button></td>
      </tr>
      <!-- Add more rows here -->

      <tr>
  <td>06/01/25</td>
  <td>Juan De Luna</td>
  <td>Noise</td>
  <td><span class="status">Pending</span></td>
  <td><button class="details-btn">View</button></td>
</tr>
<tr>
  <td>06/02/25</td>
  <td>Juan De Luna</td>
  <td>Littering</td>
  <td><span class="status">In Progress</span></td>
  <td><button class="details-btn">View</button></td>
</tr>
<tr>
  <td>06/03/25</td>
  <td>Juan De Luna</td>
  <td>Sanitation</td>
  <td><span class="status">In Progress</span></td>
  <td><button class="details-btn">View</button></td>
</tr>
<tr>
  <td>06/04/25</td>
  <td>Juan De Luna</td>
  <td>Noise</td>
  <td><span class="status">Resolved</span></td>
  <td><button class="details-btn">View</button></td>
</tr>
<tr>
  <td>06/05/25</td>
  <td>Juan De Luna</td>
  <td>Others</td>
  <td><span class="status">Pending</span></td>
  <td><button class="details-btn">View</button></td>
</tr>
<tr>
  <td>06/06/25</td>
  <td>Juan De Luna</td>
  <td>Sanitation</td>
  <td><span class="status">Resolved</span></td>
  <td><button class="details-btn">View</button></td>
</tr>
<tr>
  <td>06/07/25</td>
  <td>Juan De Luna</td>
  <td>Littering</td>
  <td><span class="status">In Progress</span></td>
  <td><button class="details-btn">View</button></td>
</tr>
<tr>
  <td>06/08/25</td>
  <td>Juan De Luna</td>
  <td>Noise</td>
  <td><span class="status">Pending</span></td>
  <td><button class="details-btn">View</button></td>
</tr>
<tr>
  <td>06/09/25</td>
  <td>Juan De Luna</td>
  <td>Others</td>
  <td><span class="status">Resolved</span></td>
  <td><button class="details-btn">View</button></td>
</tr>
<tr>
  <td>06/10/25</td>
  <td>Juan De Luna</td>
  <td>Sanitation</td>
  <td><span class="status">Pending</span></td>
  <td><button class="details-btn">View</button></td>
</tr>

    </tbody>
  </table>

  <!-- Pagination area -->
  <div class="pagination" id="pagination"></div>
</div>

</div> <!-- end of .complaints-section -->

<!-- Enhanced Modal -->
    <div id="complaintModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Complaint Details</h2>
                <span class="close-modal">&times;</span>
            </div>

            <div class="modal-body">
                <!-- Status Section -->
                <h3>üìå Current Status</h3>
                <div class="info-card">
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">Status</span>
                            <span id="modalStatus" class="status-badge"></span>
                        </div>
                    </div>
                </div>

                <!-- Personal Information -->
                <h3>üë§ Personal Information</h3>
                <div class="info-card">
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">Full Name</span>
                            <span id="modalName" class="info-value"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Age</span>
                            <span id="modalAge" class="info-value"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Gender</span>
                            <span id="modalGender" class="info-value"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Contact Number</span>
                            <span id="modalContact" class="info-value"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Email Address</span>
                            <span id="modalEmail" class="info-value"></span>
                        </div>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Home Address</span>
                        <span id="modalAddress" class="info-value"></span>
                    </div>
                </div>

                <!-- Complaint Details -->
                <h3>üìÑ Complaint Details</h3>
                <div class="info-card">
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">Date Filed</span>
                            <span id="modalDateFiled" class="info-value"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Type of Complaint</span>
                            <span id="modalType" class="info-value"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Incident Date & Time</span>
                            <span id="modalIncidentDate" class="info-value"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Location of Incident</span>
                            <span id="modalLocation" class="info-value"></span>
                        </div>
                    </div>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">Respondent Name</span>
                            <span id="modalRespondent" class="info-value"></span>
                        </div>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Respondent Address</span>
                        <span id="modalRespondentAddress" class="info-value"></span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Description of Incident</span>
                        <div class="description-box" id="modalDescription"></div>
                    </div>
                </div>

                <!-- Witness Details -->
                <h3>üë• Witness Details</h3>
                <div class="info-card">
                    <div class="witness-info">
                        <div class="witness-item">
                            <div class="info-item">
                                <span class="info-label">Witness Name</span>
                                <span id="modalWitnessName" class="info-value"></span>
                            </div>
                        </div>
                        <div class="witness-item">
                            <div class="info-item">
                                <span class="info-label">Witness Contact</span>
                                <span id="modalWitnessContact" class="info-value"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Supporting Evidence -->
                <h3>üì∏ Supporting Evidence</h3>
                <div class="info-card">
                    <div class="evidence-grid" id="modalEvidence">
                        <!-- Evidence images will be populated here -->
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button id="cancelComplaintBtn" class="btn cancel-complaint-btn">Cancel Complaint</button>
                <button id="printBtn" class="btn print-btn">Print Details</button>
            </div>
        </div>
    </div>
  </main>
 
   <!--FOOTER SECTION-->
		<footer class="footer">
            <div class="footer-left">
                <img class="market-area-logo2" src="logo.png" alt="Barangay Logo" />
                <p class="a-barangay-that">
                    A Barangay that is God-centered, united, service-oriented, inclusive, and responsive ‚Äî guided by faith, integrity, and accountable governance.
                </p>
            </div>

            <div class="footer-right-group">
                <div class="footer-middle">
              <h4 class="footer-heading">Quick Links</h4>
      				<p class="footer-link"><a href="my_complaints.html" id="footer-link">My Complaints</a></p>
              <p class="footer-link"><a href="contact.html" id="footer-link">Contacts</a></p>
              <p class="footer-link"><a href="accounts_security.html" id="footer-link">Settings</a></p>
                </div>

            <div class="footer-right">
                <h4 class="footer-heading">Site Info</h4>
                <p class="footer-link"><a href="privpolicy.html" id="footer-link"> Policy</a></p>
                <p class="footer-link"><a href="term&con.html" id="footer-terms-link">Terms & Conditions</a></p>
                <p class="footer-link"><a href="#" id="footer-terms-link"> </a></p>
            </div>
            </div>
            </footer>
  </div>
</div>

<!-- Enhanced Logout Modal -->
    <div id="logoutConfirmModal" class="out-custom-modal">
        <div class="out-modal-content">
            <button class="close-out-btn" onclick="hideLogoutModal()" aria-label="Close">&times;</button>
            
            <div class="out-modal-icon">
                <span>üö™</span>
            </div>
            
            <h2 class="out-modal-title">Confirm Logout</h2>
            <p class="out-modal-message">
                Are you sure you want to logout? You will need to sign in again to access your account.
            </p>
            
            <div class="out-modal-buttons">
                <button class="out-btn out-btn-cancel" onclick="hideLogoutModal()">
                    Cancel
                </button>
                <button class="out-btn out-btn-confirm" onclick="proceedWithLogout()">
                    Yes, Logout
                </button>
            </div>
        </div>
    </div>


 <script>
// ==== PROFILE SIDEBAR TOGGLE ====
const profileTrigger = document.getElementById('profileTrigger');
const sidebar = document.getElementById('profileSidebar');

profileTrigger.addEventListener('click', (e) => {
  e.preventDefault();
  sidebar.classList.toggle('show');
});

document.addEventListener('click', (e) => {
  if (!document.querySelector('.profile-sidebar-wrapper').contains(e.target)) {
    sidebar.classList.remove('show');
  }
});

// ==== ENHANCED LOGOUT CONFIRMATION ====

function showLogoutConfirmation() {
    const logoutModal = document.getElementById('logoutConfirmModal');
    logoutModal.style.display = 'flex';

    setTimeout(() => {
        logoutModal.classList.add('show');
    }, 10);

    document.body.style.overflow = 'hidden';
    trapFocus(logoutModal);

    return false;
}

function hideLogoutModal() {
    const logoutModal = document.getElementById('logoutConfirmModal');
    logoutModal.classList.remove('show');

    setTimeout(() => {
        logoutModal.style.display = 'none';
        document.body.style.overflow = '';
    }, 300);
}

function proceedWithLogout() {
    const confirmBtn = document.querySelector('.out-btn-confirm');
    const originalText = confirmBtn.textContent;
    confirmBtn.textContent = 'Logging out...';
    confirmBtn.disabled = true;

    setTimeout(() => {
        window.location.href = "residentLogin.html";
    }, 1000);
}

document.getElementById('logoutConfirmModal').addEventListener('click', function(e) {
    if (e.target === this) {
        hideLogoutModal();
    }
});

document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        hideLogoutModal();
    }
});

function trapFocus(logoutModal) {
    const focusableElements = logoutModal.querySelectorAll(
        'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
    );
    const firstElement = focusableElements[0];
    const lastElement = focusableElements[focusableElements.length - 1];

    logoutModal.addEventListener('keydown', function(e) {
        if (e.key === 'Tab') {
            if (e.shiftKey) {
                if (document.activeElement === firstElement) {
                    lastElement.focus();
                    e.preventDefault();
                }
            } else {
                if (document.activeElement === lastElement) {
                    firstElement.focus();
                    e.preventDefault();
                }
            }
        }
    });

    firstElement.focus();
}

let logoutInactivityTimer;

function resetLogoutInactivityTimer() {
    clearTimeout(logoutInactivityTimer);
    logoutInactivityTimer = setTimeout(() => {
        if (document.getElementById('logoutConfirmModal').style.display === 'flex') {
            hideLogoutModal();
        }
    }, 30000);
}

['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'].forEach(event => {
    document.addEventListener(event, resetLogoutInactivityTimer, true);
});

// ==== DROPDOWN FILTER TOGGLE ====
function toggleDropdown() {
  const dropdownMenu = document.getElementById('dropdownMenu');
  dropdownMenu.style.display = (dropdownMenu.style.display === 'block') ? 'none' : 'block';
}

window.addEventListener('click', (e) => {
  if (!document.querySelector('.dropdown').contains(e.target)) {
    document.getElementById('dropdownMenu').style.display = 'none';
  }
});

// ==== TABLE FILTER + PAGINATION ====
const rowsPerPage = 5;
let currentPage = 1;
const table = document.getElementById("complaintsTable");
const tbody = table.querySelector("tbody");
const pagination = document.getElementById("pagination");
const searchInput = document.getElementById("search-input");

function getFilteredRows() {
  const searchVal = searchInput.value.toLowerCase();
  const dateVal = document.getElementById('filter-date').value;
  const typeVal = document.getElementById('filter-type').value.toLowerCase();
  const statusVal = document.getElementById('filter-status').value.toLowerCase();

  return Array.from(tbody.querySelectorAll("tr")).filter(row => {
    const [date, name, type, status] = Array.from(row.cells).map(cell => cell.textContent.trim().toLowerCase());
    return (
      (!dateVal || date.includes(dateVal)) &&
      (!typeVal || type.includes(typeVal)) &&
      (!statusVal || status.includes(statusVal)) &&
      (!searchVal || name.includes(searchVal) || type.includes(searchVal) || status.includes(searchVal))
    );
  });
}

function renderTable() {
  const rows = Array.from(tbody.querySelectorAll("tr"));
  const filteredRows = getFilteredRows();
  const start = (currentPage - 1) * rowsPerPage;
  const end = start + rowsPerPage;

  rows.forEach(row => row.style.display = "none");
  filteredRows.slice(start, end).forEach(row => row.style.display = "table-row");
  renderPagination(filteredRows.length);
}

function renderPagination(totalRows) {
  pagination.innerHTML = "";
  const pageCount = Math.ceil(totalRows / rowsPerPage);

  const createPageBtn = (label, disabled, handler) => {
    const btn = document.createElement("button");
    btn.textContent = label;
    btn.className = "page-btn";
    btn.disabled = disabled;
    btn.addEventListener("click", handler);
    return btn;
  };

  pagination.appendChild(createPageBtn("‚Üê Previous", currentPage === 1, () => { currentPage--; renderTable(); }));
  for (let i = 1; i <= pageCount; i++) {
    const btn = createPageBtn(i, false, () => { currentPage = i; renderTable(); });
    if (i === currentPage) btn.classList.add('active');
    pagination.appendChild(btn);
  }
  pagination.appendChild(createPageBtn("Next ‚Üí", currentPage === pageCount, () => { currentPage++; renderTable(); }));
}

function applyFilters() {
  currentPage = 1;
  renderTable();
  document.getElementById('dropdownMenu').style.display = 'none';
}

function clearFilters() {
  document.getElementById('filter-date').value = '';
  document.getElementById('filter-type').value = '';
  document.getElementById('filter-status').value = '';
  searchInput.value = '';
  applyFilters();
}

searchInput.addEventListener("input", () => {
  currentPage = 1;
  renderTable();
});

renderTable();

// ==== STATUS BADGE STYLING FOR TABLE ====
document.querySelectorAll('.status').forEach(status => {
  const text = status.textContent.trim().toLowerCase();
  status.classList.add(`status-${text.replace(/\s+/g, '-')}`);
});

// ==== MODAL FUNCTIONALITY ====
const modal = document.getElementById('complaintModal');
const closeModalBtn = document.querySelector('.close-modal');
const cancelBtn = document.getElementById('cancelComplaintBtn');
const printBtn = document.getElementById('printBtn');

const modalFields = {
  dateFiled: document.getElementById('modalDateFiled'),
  name: document.getElementById('modalName'),
  age: document.getElementById('modalAge'),
  gender: document.getElementById('modalGender'),
  address: document.getElementById('modalAddress'),
  contact: document.getElementById('modalContact'),
  email: document.getElementById('modalEmail'),
  type: document.getElementById('modalType'),
  incidentDate: document.getElementById('modalIncidentDate'),
  location: document.getElementById('modalLocation'),
  respondent: document.getElementById('modalRespondent'),
  respondentAddress: document.getElementById('modalRespondentAddress'),
  description: document.getElementById('modalDescription'),
  witnessName: document.getElementById('modalWitnessName'),
  witnessContact: document.getElementById('modalWitnessContact'),
  status: document.getElementById('modalStatus'),
  evidenceContainer: document.getElementById('modalEvidence')
};

// Example complaint data (replace with backend data later)
const complaintDetails = [
  {
      age: '31',
                gender: 'Male',
                address: '123 Maple Street, Brgy. San Juan, Lipa City, Batangas',
                contact: '09178920304',
                email: 'juandeluna@gmail.com',
                incidentDate: '03/02/25, 2:00 AM',
                location: 'Rawr Street, ABC Village',
                respondent: 'Jose De Luna',
                respondentAddress: '456 Oak Avenue, Brgy. Poblacion, Lipa City',
                description: 'Loud noises every night from the neighbor\'s party until 3am. The music is extremely loud and prevents my family from sleeping. This has been happening for over two weeks now, and attempts to talk to them have been unsuccessful.',
                witnessName: 'Maria Luna',
                witnessContact: '09123456789',
                evidence: [
                    { name: 'Audio Recording - Night Disturbance.mp3', type: 'audio', size: '2.5 MB', icon: 'üéµ' },
                    { name: 'Photo Evidence - Loud Party.jpg', type: 'image', size: '1.8 MB', icon: 'üì∑' },
                    { name: 'Time Log Documentation.pdf', type: 'document', size: '245 KB', icon: 'üìÑ' },
                    { name: 'Witness Statement.docx', type: 'document', size: '156 KB', icon: 'üìù' }
                ]
            },
  // Add more complaint detail objects for each row...
];

document.querySelectorAll('.details-btn').forEach((btn, index) => {
  btn.addEventListener('click', () => {
    const row = btn.closest('tr');
    const cells = row.querySelectorAll('td');
    const details = complaintDetails[index] || {};

    modalFields.dateFiled.textContent = cells[0].textContent.trim();
    modalFields.name.textContent = cells[1].textContent.trim();
    modalFields.type.textContent = cells[2].textContent.trim();

    const statusText = cells[3].textContent.trim();
    modalFields.status.textContent = statusText;
    modalFields.status.className = 'status-badge';
    modalFields.status.classList.add(`status-${statusText.toLowerCase().replace(/\s+/g, '-')}`);

    modalFields.age.textContent = details.age || 'N/A';
    modalFields.gender.textContent = details.gender || 'N/A';
    modalFields.address.textContent = details.address || 'N/A';
    modalFields.contact.textContent = details.contact || 'N/A';
    modalFields.email.textContent = details.email || 'N/A';
    modalFields.incidentDate.textContent = details.incidentDate || 'N/A';
    modalFields.location.textContent = details.location || 'N/A';
    modalFields.respondent.textContent = details.respondent || 'N/A';
    modalFields.respondentAddress.textContent = details.respondentAddress || 'N/A';
    modalFields.description.textContent = details.description || 'N/A';
    modalFields.witnessName.textContent = details.witnessName || 'N/A';
    modalFields.witnessContact.textContent = details.witnessContact || 'N/A';

    // Evidence Images
    modalFields.evidenceContainer.innerHTML = '';
    (details.evidence || []).forEach(src => {
      const img = document.createElement('img');
      img.src = src;
      img.alt = "Evidence";
      img.className = 'evidence-image';
      modalFields.evidenceContainer.appendChild(img);
    });

    // Hide cancel button for resolved status
    cancelBtn.style.display = (statusText.toLowerCase() === 'resolved') ? 'none' : 'inline-block';

    // Show modal using CSS classes instead of inline styles
    modal.style.display = 'flex';
    document.body.classList.add('modal-open'); // Prevent background scroll
  });
});

closeModalBtn.addEventListener('click', () => {
  modal.style.display = 'none';
  document.body.classList.remove('modal-open'); // Remove background scroll lock
});

window.addEventListener('click', (e) => {
  if (e.target === modal) {
    modal.style.display = 'none';
    document.body.classList.remove('modal-open'); // Remove background scroll lock
  }
});

cancelBtn.addEventListener('click', () => {
  if (confirm("Are you sure you want to cancel this complaint?")) {
    alert("Complaint has been cancelled.");
    modal.style.display = 'none';
    document.body.classList.remove('modal-open');
  }
});
</script>


</body>
</html>
