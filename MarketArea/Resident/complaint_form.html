<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>E-Blotter Information Form</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="cform.css">
  <link rel="icon" type="image/png" href="logo.png">
</head>
<body>
 
  <!-- HEADER SECTION -->
  <header class="header_gradient">
    <div class="header-left">
      <img class="market-area-logo" src="logo.png" alt="Logo" />
      <div class="barangay-title">
        <p class="barangay-market-area">Barangay Market Area:<br>E-Blotter System</p>
      </div>
    </div>

    <div class="navbar">
      <div class="nav-links">
        <a href="residentHomepage.html">Home</a>
        <a href="my_complaints.html">My Complaints</a>
        <a href="contact.html">Contacts</a>
      </div>

      <!-- Profile + Sidebar Wrapper -->
      <div class="profile-sidebar-wrapper">
        <div class="profile-link" id="profileTrigger">
          <div class="profile"></div>
        </div>

        <!-- Collapsible Sidebar -->
  			<div class="sidebar collapsed" id="profileSidebar">
  				<a href="accounts_security.html" class="sidebar-item" data-tooltip="Adjust your settings">
    				<i class="icon">‚öôÔ∏è</i>
    				<span class="label">Settings</span>
  				</a>
  				<a href="residentLogin.html" class="sidebar-item" id="logout-btn" onclick="return showLogoutConfirmation()" data-tooltip="Log out from your account">
          <i class="icon">üö™</i>
          <span class="label">Logout</span>
          </a>

        </div>

			</div>
      </div>
    </div>
  </header>

  <section class="page-container">
    <main class="form-container">
      <form id="blotter-form" class="e-blotter-form">
        <h2>E-Blotter Information Form</h2>
        <p class="instruction">Fill all input fields.</p>

        <div class="blotter-progress-container">
          <div class="blotter-progress-line">
            <div class="blotter-step active">Personal Info</div>
            <div class="blotter-step">Complaint</div>
            <div class="blotter-step">Evidence</div>
          </div>
        </div>

        <!-- Personal Information -->
        <fieldset class="form-step active">
  <legend class="section-title">Complainant Personal Information</legend>

  <!-- 2-Column Group -->
  <div class="form-row">
    <div class="form-col">
      <label>
        <span class="label-title">Last Name <span class="required">*</span></span>
        <input type="text" placeholder="Last Name" required>
      </label>
    </div>
    <div class="form-col">
      <label>
        <span class="label-title">First Name <span class="required">*</span></span>
        <input type="text" placeholder="First Name" required>
      </label>
    </div>
     <div class="form-col">
        <label>
        <span class="label-title">Middle Name</span>
        <input type="text" placeholder="Middle Name">
      </label>
    </div>
  </div>
 
  <div class="form-row">
    <div class="form-col">
      <label>
        <span class="label-title">Suffix</span>
        <input type="text" placeholder="Suffix">
      </label>
    </div>

    <div class="form-col">
        <label>
          <span class="label-title">Sex <span class="required">*</span></span>
            <select name="Sex" id="Sex" required>
              <option value="" selected disabled>Sex</option>
              <option value="Male">Male</option>
              <option value="Female">Female</option>
              <option value="Other">Other</option>
          </select>
        </label>
    </div>

   <div class="form-col">
    <label>
      <span class="label-title">Age <span class="required">*</span></span>
        <div class="custom-age-wrapper">
          <input type="text" id="ageSelect" name="age" placeholder="Select or type age" autocomplete="off" required />
          <ul id="customAgeList" class="custom-age-list"></ul>
        </div>
     </label>
    </div>



    </div>
  </div>

  <div class="form-row">
    <div class="form-col">
      <label>
        <span class="label-title">Contact Number <span class="required">*</span></span>
        <input type="text" placeholder="Contact Number" required>
      </label>
    </div>
      <div class="form-col">
        <label>
        <span class="label-title">Address <span class="required">*</span></span>
        <input type="text" placeholder="Address" required>
      </label>
  </div>
</fieldset>


       <!-- Complaint Details -->
<fieldset class="form-step">
  <legend class="section-title">Complaint Details</legend>

  <div class="form-row">
    <div class="form-col">
      <label>
        <span class="label-title">Type of Complaint <span class="required">*</span></span>
          <select id="complaintType" name="complaintType" required onchange="toggleOtherInput(this)">
            <option value="" selected disabled>Select type of complaint</option>
            <option value="Noise">Noise</option>
            <option value="Vandalism">Vandalism</option>
            <option value="Neighbourhood Dispute">Neighbourhood Dispute</option>
            <option value="Unpaid Debt">Unpaid Debt</option>
            <option value="Other">Other</option>
          </select>
      </label>
    </div>

    <div class="form-col" id="otherComplaintDiv" style="display: none;">
    <label>
      <span class="label-title">Please specify <span class="required">*</span></span>
      <input type="text" id="otherComplaint" name="otherComplaint" placeholder="Specify complaint type">
    </label>
    </div>
  </div>

  <div class="form-row">
    <div class="form-col">
      <label>
        <span class="label-title">Location of the Incident <span class="required">*</span></span>
        <input type="text" placeholder="Location of the Incident" required>
      </label>
    </div>
    <div class="form-col">
      <label>
        <span class="label-title">Date of Incident <span class="required">*</span></span>
        <input type="date" required>
      </label>
    </div>
    <div class="form-col">
      <label>
        <span class="label-title">Time of Incident <span class="required">*</span></span>
        <input type="time" required>
      </label>
    </div>
  </div>

  <div class="form-row">
    <div class="form-col">
      <label>
        <span class="label-title">Full Name of the Respondent <span class="required">*</span></span>
        <input type="text" placeholder="Full Name" required>
      </label>
    </div>
    <div class="form-col">
      <label>
        <span class="label-title">Address of the Respondent <span class="required">*</span></span>
        <input type="text" placeholder="Respondent Address" required>
      </label>
    </div>
    <div class="form-col">
      <label>
        <span class="label-title">Contact of the Respondent <span class="required">*</span></span>
        <input type="text" placeholder="Contact Number" required>
      </label>
    </div>
  </div>

  <div class="form-row">
  <div class="form-col full-width">
    <label>
      <span class="label-title">
        Detailed Description of the Incident <span class="required">*</span>
      </span>
      <textarea 
        id="incidentDescription" 
        placeholder="Detailed Description of the Incident" 
        required 
        oninput="limitWords(this, 200)"
      ></textarea>
      <div id="wordCount" class="word-count">0 / 200 words</div>
    </label>
  </div>
</div>
</fieldset>

<!-- Supporting Evidence -->
<fieldset class="form-step">
  <legend class="section-title">Supporting Evidence</legend>

  
<!-- Evidence Upload -->
<div class="form-row">
  <div class="form-col full-width">
    <label class="label-title">Photos, videos or screenshots</label>
    
    <input type="file" id="evidenceFiles" name="evidenceFiles" accept="image/*,video/*" multiple>
    
    <div id="selected-files" class="file-list"></div>
    <p class="small-note">You may select multiple images or videos.</p>
  </div>
</div>

  <!-- Witness Section -->
  <div class="form-row">
    <div class="form-col full-width">
      <span class="label-title">Witness (N/A if none)</span>
    </div>
  </div>
  <div class="form-row witness-row">
    <div class="witness-column">
      <label>
        <span class="label-title">Name</span>
        <input type="text" placeholder="Name">
      </label>
      <label>
        <span class="label-title">Contact Number</span>
        <input type="text" placeholder="Contact Number">
      </label>
    </div>
    <div class="witness-column">
      <label>
        <span class="label-title">Name</span>
        <input type="text" placeholder="Name">
      </label>
      <label>
        <span class="label-title">Contact Number</span>
        <input type="text" placeholder="Contact Number">
      </label>
    </div>
  </div>
</fieldset>

 <!-- Terms and Conditions (visually outside fieldset) -->
<div class="form-row terms-wrapper evidence-terms" style="display: none;">
  <div class="terms-align-right">
    <label class="terms-label">
      <input type="checkbox" id="terms-checkbox" required>
      I agree to the <a href="term&con.html">Terms and Conditions</a>
    </label>
  </div>
</div>

<!-- Navigation Buttons -->
<div class="form-nav-center">
  <button type="button" class="nav-btn prev-btn" onclick="prevStep()">Previous</button>
  <button type="button" class="nav-btn next-btn" onclick="nextStep()">Next</button>
  <button type="submit" class="submit-btn nav-btn">Submit Complaint</button>
</div>

      </form>
    </main>
  </section>

  <!--Successful submit popup-->
  <div id="successPopup" class="popup-overlay">
  <div class="popup-box">
    <h3>Complaint Submitted</h3>
    <p>Your complaint has been submitted successfully.</p>
    <button onclick="closeSuccessPopup()" class="popup-btn">OK</button>
  </div>
</div>

  <!-- FOOTER SECTION -->
  <footer class="footer">
    <div class="footer-left">
      <img class="market-area-logo2" src="logo.png" alt="Barangay Logo" />
      <p class="a-barangay-that">
        A Barangay that is God-centered, united, service-oriented, inclusive, and responsive ‚Äî guided by faith, integrity, and accountable governance.
      </p>
    </div>
    <div class="footer-right-group">
      <div class="footer-middle">
       <h4 class="footer-heading">Quick Links</h4>
        <p class="footer-link"><a href="my_complaints.html" id="footer-link">My Complaints</a></p>
        <p class="footer-link"><a href="contact.html" id="footer-link">Contacts</a></p>
        <p class="footer-link"><a href="settings.html" id="footer-link">Settings</a></p>
      </div>
      <div class="footer-right">
        <h4 class="footer-heading">Site Info</h4>
        <p class="footer-link"><a href="privpolicy.html">Policy</a></p>
        <p class="footer-link"><a href="term&con.html">Terms and Conditions</a></p>
        <br>

        
      </div>
    </div>
  </footer>

 <!-- Enhanced Logout Modal -->
    <div id="logoutConfirmModal" class="out-custom-modal">
        <div class="out-modal-content">
            <button class="close-out-btn" onclick="hideLogoutModal()" aria-label="Close">&times;</button>
            
            <div class="out-modal-icon">
                <span>üö™</span>
            </div>
            
            <h2 class="out-modal-title">Confirm Logout</h2>
            <p class="out-modal-message">
                Are you sure you want to logout? You will need to sign in again to access your account.
            </p>
            
            <div class="out-modal-buttons">
                <button class="out-btn out-btn-cancel" onclick="hideLogoutModal()">
                    Cancel
                </button>
                <button class="out-btn out-btn-confirm" onclick="proceedWithLogout()">
                    Yes, Logout
                </button>
            </div>
        </div>
    </div>

  <script>
    const profileTrigger = document.getElementById('profileTrigger');
    const sidebar = document.getElementById('profileSidebar');

    profileTrigger.addEventListener('click', (e) => {
      e.preventDefault();
      sidebar.classList.toggle('show');
    });

    document.addEventListener('click', function (e) {
      const wrapper = document.querySelector('.profile-sidebar-wrapper');
      if (!wrapper.contains(e.target)) {
        sidebar.classList.remove('show');
      }
    });

    const steps = document.querySelectorAll('.form-step');
    const progressSteps = document.querySelectorAll('.blotter-step');
    const prevBtn = document.querySelector('.prev-btn');
    const nextBtn = document.querySelector('.next-btn');
    const submitBtn = document.querySelector('.submit-btn');

    let currentStep = 0;

    function updateFormSteps() {
  steps.forEach((step, index) => {
    step.style.display = index === currentStep ? 'block' : 'none';
  });

  progressSteps.forEach((step, index) => {
    step.classList.toggle('active', index === currentStep);
  });

  prevBtn.disabled = currentStep === 0;
  nextBtn.style.display = currentStep === steps.length - 1 ? 'none' : 'inline-block';
  submitBtn.style.display = currentStep === steps.length - 1 ? 'inline-block' : 'none';

  // Show Terms and Conditions only during Supporting Evidence step
  const termsWrapper = document.querySelector('.evidence-terms');
  if (currentStep === 2) { // Adjust this index based on where your Supporting Evidence step is
    termsWrapper.style.display = 'flex';
  } else {
    termsWrapper.style.display = 'none';
  }
}

    function nextStep() {
      const currentInputs = steps[currentStep].querySelectorAll('input, select, textarea');
      for (let input of currentInputs) {
        if (!input.checkValidity()) {
          input.reportValidity();
          return;
        }
      }

      if (currentStep < steps.length - 1) {
        currentStep++;
        updateFormSteps();
      }
    }

    function prevStep() {
      if (currentStep > 0) {
        currentStep--;
        updateFormSteps();
      }
    }

    updateFormSteps();

    const form = document.getElementById('blotter-form');
    form.addEventListener('submit', function(e) {
      e.preventDefault();

      const personalInfoInputs = steps[0].querySelectorAll('input, select');
      const complaintDetailsInputs = steps[1].querySelectorAll('input, select, textarea');

      for (let input of [...personalInfoInputs, ...complaintDetailsInputs]) {
        if (!input.checkValidity()) {
          if (steps[0].contains(input)) {
            currentStep = 0;
          } else {
            currentStep = 1;
          }
          updateFormSteps();
          input.reportValidity();
          return;
        }
      }

      if (!document.getElementById('terms-checkbox').checked) {
        alert('Please agree to the Terms and Conditions.');
        return;
      }

      document.getElementById('successPopup').style.display = 'flex';

    });
    
// close successful submit
    function closeSuccessPopup() {
        document.getElementById('successPopup').style.display = 'none';
        form.reset();
        currentStep = 0;
        updateFormSteps();
      }



// SPECIFY COMPLAINT TYPE

function toggleOtherInput(select) {
    const otherDiv = document.getElementById('otherComplaintDiv');
    const otherInput = document.getElementById('otherComplaint');
    if (select.value === 'Other') {
      otherDiv.style.display = 'block';
      otherInput.setAttribute('required', 'required');
    } else {
      otherDiv.style.display = 'none';
      otherInput.removeAttribute('required');
      otherInput.value = '';
    }
  }

// word limit on desc

function limitWords(textarea, maxWords) {
    const words = textarea.value.trim().split(/\s+/);
    const wordCount = words.filter(word => word.length > 0).length;

    const counter = document.getElementById('wordCount');
    counter.textContent = `${wordCount} / ${maxWords} words`;

    if (wordCount > maxWords) {
      // Trim extra words
      textarea.value = words.slice(0, maxWords).join(" ");
      counter.textContent = `${maxWords} / ${maxWords} words`;
    }
  }

  // age dropdown

const ageInput = document.getElementById('ageSelect');
const ageList = document.getElementById('customAgeList');

// Populate the list
for (let i = 1; i <= 100; i++) {
  const li = document.createElement('li');
  li.textContent = i;
  li.addEventListener('click', () => {
    ageInput.value = i;
    ageList.style.display = 'none';
  });
  ageList.appendChild(li);
}

// Show all on focus
ageInput.addEventListener('focus', () => {
  const items = ageList.querySelectorAll('li');
  items.forEach(item => item.style.display = 'block');
  ageList.style.display = 'block';
});

// Filter list while typing
ageInput.addEventListener('input', () => {
  const query = ageInput.value.trim();
  const items = ageList.querySelectorAll('li');
  let hasMatch = false;

  items.forEach(item => {
    if (item.textContent.startsWith(query)) {
      item.style.display = 'block';
      hasMatch = true;
    } else {
      item.style.display = 'none';
    }
  });

  ageList.style.display = hasMatch ? 'block' : 'none';
});

// Prevent blur when clicking list items
let blurTimeout;

ageInput.addEventListener('blur', () => {
  blurTimeout = setTimeout(() => {
    ageList.style.display = 'none';
  }, 100);
});

ageList.addEventListener('mousedown', () => {
  clearTimeout(blurTimeout); // Prevent dropdown from closing during click
});

// Hide dropdown when clicking outside
document.addEventListener('click', (e) => {
  if (!document.querySelector('.custom-age-wrapper').contains(e.target)) {
    ageList.style.display = 'none';
  }
});

   // File upload preview and removal
const evidenceInput = document.getElementById('evidenceFiles');
const fileListContainer = document.getElementById('selected-files');
let selectedFiles = [];

evidenceInput.addEventListener('change', function () {
  selectedFiles = Array.from(this.files); // Save selected files
  renderFileList();
});

function renderFileList() {
  fileListContainer.innerHTML = '';

  selectedFiles.forEach((file, index) => {
    const fileItem = document.createElement('div');
    fileItem.className = 'file-item';

    const fileName = document.createElement('div');
    fileName.className = 'file-name';
    fileName.textContent = `üìÅ ${file.name}`;

    const removeBtn = document.createElement('button');
    removeBtn.className = 'remove-file';
    removeBtn.innerHTML = '‚úñ';
    removeBtn.onclick = () => {
      selectedFiles.splice(index, 1);
      renderFileList();
    };

    fileItem.appendChild(fileName);
    fileItem.appendChild(removeBtn);
    fileListContainer.appendChild(fileItem);
  });

  // Sync input with updated file list
  const dataTransfer = new DataTransfer();
  selectedFiles.forEach(file => dataTransfer.items.add(file));
  evidenceInput.files = dataTransfer.files;
}

// red asterisk

document.querySelectorAll('.form-step input[required], .form-step textarea[required], .form-step select[required]').forEach(input => {
  input.addEventListener('input', function () {
    const requiredSpan = this.closest('label')?.querySelector('.required');
    if (requiredSpan) {
      requiredSpan.style.visibility = this.value.trim() ? 'hidden' : 'visible';
    }
  });
});


// ==== ENHANCED LOGOUT CONFIRMATION ====
        
        function showLogoutConfirmation() {
            const logoutModal = document.getElementById('logoutConfirmModal');
            logoutModal.style.display = 'flex';
            
            // Add show class after a brief delay for smooth animation
            setTimeout(() => {
                logoutModal.classList.add('show');
            }, 10);
            
            // Prevent body scroll when modal is open
            document.body.style.overflow = 'hidden';
            
            // Focus trap for accessibility
            trapFocus(logoutModal);
            
            return false; // Prevent the <a> tag from redirecting
        }

        function hideLogoutModal() {
            const logoutModal = document.getElementById('logoutConfirmModal');
            logoutModal.classList.remove('show');
            
            // Hide modal after animation completes
            setTimeout(() => {
                logoutModal.style.display = 'none';
                document.body.style.overflow = ''; // Restore body scroll
            }, 300);
        }

        function proceedWithLogout() {
            // Show loading state
            const confirmBtn = document.querySelector('.out-btn-confirm');
            const originalText = confirmBtn.textContent;
            confirmBtn.textContent = 'Logging out...';
            confirmBtn.disabled = true;
            
            // Simulate logout process (replace with your actual logout logic)
            setTimeout(() => {
                // Redirect to login page
                window.location.href = "residentLogin.html";
            }, 1000);
        }

        // Enhanced Features
        
        // Close modal when clicking outside
        document.getElementById('logoutConfirmModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideLogoutModal();
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                hideLogoutModal();
            }
        });

        // Focus trap for accessibility
        function trapFocus(logoutModal) {
            const focusableElements = logoutModal.querySelectorAll(
                'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
            );
            const firstElement = focusableElements[0];
            const lastElement = focusableElements[focusableElements.length - 1];

            logoutModal.addEventListener('keydown', function(e) {
                if (e.key === 'Tab') {
                    if (e.shiftKey) {
                        if (document.activeElement === firstElement) {
                            lastElement.focus();
                            e.preventDefault();
                        }
                    } else {
                        if (document.activeElement === lastElement) {
                            firstElement.focus();
                            e.preventDefault();
                        }
                    }
                }
            });

            // Focus first element
            firstElement.focus();
        }

        // Optional: Auto-close after inactivity
        let logoutInactivityTimer;
        
        function resetLogoutInactivityTimer() {
            clearTimeout(logoutInactivityTimer);
            logoutInactivityTimer = setTimeout(() => {
                if (document.getElementById('logoutConfirmModal').style.display === 'flex') {
                    hideLogoutModal();
                }
            }, 30000); // Auto-close after 30 seconds of inactivity
        }

        // Reset timer on user interaction
        ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'].forEach(event => {
            document.addEventListener(event, resetLogoutInactivityTimer, true);
        });

  </script>

</body>
</html>
